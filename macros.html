<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>shiny: Shader Macros</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">shiny
   &#160;<span id="projectnumber">0.4</span>
   </div>
   <div id="projectbrief">a shader and material management library for OGRE</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Shader Macros </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#Shader">Language</a></li>
<li class="level1"><a href="#vertex-fragment">Vertex / fragment shader</a></li>
<li class="level1"><a href="#passthrough">Vertex -&gt; Fragment passthrough</a><ul><li class="level2"><a href="#shAllocatePassthrough">shAllocatePassthrough</a></li>
<li class="level2"><a href="#shPassthroughVertexOutputs">shPassthroughVertexOutputs</a></li>
<li class="level2"><a href="#shPassthroughFragmentInputs">shPassthroughFragmentInputs</a></li>
<li class="level2"><a href="#shPassthroughAssign">shPassthroughAssign</a></li>
<li class="level2"><a href="#shPassthroughReceive">shPassthroughReceive</a></li>
</ul>
</li>
<li class="level1"><a href="#texUnits">Texture units</a><ul><li class="level2"><a href="#shUseSampler">shUseSampler</a></li>
</ul>
</li>
<li class="level1"><a href="#properties">Property retrieval / binding</a><ul><li class="level2"><a href="#shPropertyHasValue">shPropertyHasValue</a></li>
<li class="level2"><a href="#shUniformProperty">shUniformProperty</a></li>
<li class="level2"><a href="#shPropertyBool">shPropertyBool</a></li>
<li class="level2"><a href="#shPropertyString">shPropertyString</a></li>
<li class="level2"><a href="#shPropertyEqual">shPropertyEqual</a></li>
</ul>
</li>
<li class="level1"><a href="#globalSettings">Global settings</a><ul><li class="level2"><a href="#shGlobalSettingBool">shGlobalSettingBool</a></li>
<li class="level2"><a href="#shGlobalSettingEqual">shGlobalSettingEqual</a></li>
<li class="level2"><a href="#shGlobalSettingString">shGlobalSettingString</a></li>
</ul>
</li>
<li class="level1"><a href="#sharedParams">Shared parameters</a><ul><li class="level2"><a href="#shSharedParameter">shSharedParameter</a></li>
</ul>
</li>
<li class="level1"><a href="#autoconstants">Auto constants</a><ul><li class="level2"><a href="#shAutoConstant">shAutoConstant</a></li>
</ul>
</li>
<li class="level1"><a href="#misc">Misc</a><ul><li class="level2"><a href="#shForeach">shForeach</a></li>
<li class="level2"><a href="#shCounter">shCounter</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="Shader"></a>
Language</h1>
<p>These macros are automatically defined, depending on the shader language that has been set by the application using <a class="el" href="classsh_1_1_factory.html#a835a965878ce0a01bfd90f2e4eb57252" title="Switch between different shader languages (cg, glsl, hlsl) ">sh::Factory::setCurrentLanguage</a>.</p>
<ul>
<li>SH_GLSL</li>
<li>SH_HLSL</li>
<li>SH_CG</li>
</ul>
<p><b>Example:</b></p>
<div class="fragment"><div class="line"><span class="preprocessor">#if SH_GLSL == 1</span></div><div class="line"> <span class="comment">// glsl porting code</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="preprocessor">#if SH_CG == 1 || SH_HLSL == 1</span></div><div class="line"> <span class="comment">// cg / hlsl porting code (similiar syntax)</span></div><div class="line"><span class="preprocessor">#endif</span></div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>It is encouraged to use the shipped porting header (extra/core.h) by #include-ing it in your shaders. If you do that, you should not have to use the above macros directly.</dd></dl>
<h1><a class="anchor" id="vertex-fragment"></a>
Vertex / fragment shader</h1>
<p>These macros are automatically defined, depending on the type of shader that is currently being compiled.</p>
<ul>
<li>SH_VERTEX_SHADER</li>
<li>SH_FRAGMENT_SHADER</li>
</ul>
<p>If you use the same source file for both vertex and fragment shader, then it is advised to use these macros for blending out the unused source. This will reduce your compile time.</p>
<h1><a class="anchor" id="passthrough"></a>
Vertex -&gt; Fragment passthrough</h1>
<p>In shader development, a common task is to pass variables from the vertex to the fragment shader. This is no problem if you have a deterministic shader source (i.e. no #ifdefs).</p>
<p>However, as soon as you begin to have lots of permutations of the same shader source, a problem arises. All current GPUs have a limit of 8 vertex to fragment passthroughs (with 4 components each, for example a float4).</p>
<p>A common optimization is to put several individual float values together in a float4 (so-called "Packing"). But if your shader has lots of permutations and the passthrough elements you actually need are not known beforehand, it can be very tedious to pack manually. With the following macros, packing can become easier.</p>
<h2><a class="anchor" id="shAllocatePassthrough"></a>
shAllocatePassthrough</h2>
<p><b>Usage:</b> @shAllocatePassthrough(num_components, name)</p>
<p><b>Example:</b> </p><div class="fragment"><div class="line"><span class="preprocessor">#if FRAGMENT_NEED_DEPTH</span></div><div class="line">@shAllocatePassthrough(1, depth)</div><div class="line"><span class="preprocessor">#endif</span></div></div><!-- fragment --><p>This is the first thing you should do before using any of the macros below.</p>
<h2><a class="anchor" id="shPassthroughVertexOutputs"></a>
shPassthroughVertexOutputs</h2>
<p><b>Usage:</b> @shPassthroughVertexOutputs</p>
<p>Use this in the inputs/outputs section of your vertex shader, in order to declare all the outputs that are needed for packing the variables that you want passed to the fragment.</p>
<h2><a class="anchor" id="shPassthroughFragmentInputs"></a>
shPassthroughFragmentInputs</h2>
<p><b>Usage:</b> @shPassthroughFragmentInputs</p>
<p>Use this in the inputs/outputs section of your fragment shader, in order to declare all the inputs that are needed for receiving the variables that you want passed to the fragment.</p>
<h2><a class="anchor" id="shPassthroughAssign"></a>
shPassthroughAssign</h2>
<p><b>Usage:</b> @shPassthroughAssign(name, value)</p>
<p>Use this in the vertex shader for assigning a value to the variable you want passed to the fragment.</p>
<p><b>Example:</b> </p><div class="fragment"><div class="line"><span class="preprocessor">#if FRAGMENT_NEED_DEPTH</span></div><div class="line">@shPassthroughAssign(depth, shOutputPosition.z);</div><div class="line"><span class="preprocessor">#endif</span></div></div><!-- fragment --><h2><a class="anchor" id="shPassthroughReceive"></a>
shPassthroughReceive</h2>
<p><b>Usage:</b> @shPassthroughReceive(name)</p>
<p>Use this in the fragment shader to receive the passed value.</p>
<p><b>Example:</b></p>
<div class="fragment"><div class="line"><span class="preprocessor">#if FRAGMENT_NEED_DEPTH</span></div><div class="line"><span class="keywordtype">float</span> depth = @shPassthroughReceive(depth);</div><div class="line"><span class="preprocessor">#endif</span></div></div><!-- fragment --><h1><a class="anchor" id="texUnits"></a>
Texture units</h1>
<h2><a class="anchor" id="shUseSampler"></a>
shUseSampler</h2>
<p><b>Usage:</b> @shUseSampler(samplerName)</p>
<p>Requests the texture unit with name <em>samplerName</em> to be available for use in this pass.</p>
<p>Why is this necessary? If you have a derived material that does not use all of the texture units that its parent defines (for example, if an optional asset such as a normal map is not available), there would be no way to know which texture units are actually needed and which can be skipped in the creation process (those that are never referenced in the shader).</p>
<h1><a class="anchor" id="properties"></a>
Property retrieval / binding</h1>
<h2><a class="anchor" id="shPropertyHasValue"></a>
shPropertyHasValue</h2>
<p><b>Usage:</b> @shPropertyHasValue(property)</p>
<p>Gets replaced by 1 if the property's value is not empty, or 0 if it is empty. Useful for checking whether an optional texture is present or not.</p>
<p><b>Example:</b> </p><div class="fragment"><div class="line"><span class="preprocessor">#if @shPropertyHasValue(specularMap)</span></div><div class="line"> <span class="comment">// specular mapping code</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#if @shPropertyHasValue(normalMap)</span></div><div class="line"> <span class="comment">// normal mapping code</span></div><div class="line"><span class="preprocessor">#endif</span></div></div><!-- fragment --><h2><a class="anchor" id="shUniformProperty"></a>
shUniformProperty</h2>
<p><b>Usage:</b> @shUniformProperty&lt;4f|3f|2f|1f|int&gt; (uniformName, property)</p>
<p>Binds the value of <em>property</em> (from the shader_properties of the pass this shader belongs to) to the uniform with name <em>uniformName</em>.</p>
<p>The following variants are available, depending on the type of your uniform variable:</p><ul>
<li>@shUniformProperty4f</li>
<li>@shUniformProperty3f</li>
<li>@shUniformProperty2f</li>
<li>@shUniformProperty1f</li>
<li>@shUniformPropertyInt</li>
</ul>
<p><b>Example:</b> @shUniformProperty1f (uFresnelScale, fresnelScale)</p>
<h2><a class="anchor" id="shPropertyBool"></a>
shPropertyBool</h2>
<p>Retrieve a boolean property of the pass that this shader belongs to, gets replaced with either 0 or 1.</p>
<p><b>Usage:</b> @shPropertyBool(propertyName)</p>
<p><b>Example:</b> </p><div class="fragment"><div class="line"><span class="preprocessor">#if @shPropertyBool(has_vertex_colors)</span></div><div class="line">...</div><div class="line">#endif</div></div><!-- fragment --><h2><a class="anchor" id="shPropertyString"></a>
shPropertyString</h2>
<p>Retrieve a string property of the pass that this shader belongs to</p>
<p><b>Usage:</b> @shPropertyString(propertyName)</p>
<h2><a class="anchor" id="shPropertyEqual"></a>
shPropertyEqual</h2>
<p>Check if the value of a property equals a specific value, gets replaced with either 0 or 1. This is useful because the preprocessor cannot compare strings, only numbers.</p>
<p><b>Usage:</b> @shPropertyEqual(propertyName, value)</p>
<p><b>Example:</b> </p><div class="fragment"><div class="line"><span class="preprocessor">#if @shPropertyEqual(lighting_mode, phong)</span></div><div class="line">...</div><div class="line">#endif</div></div><!-- fragment --><h1><a class="anchor" id="globalSettings"></a>
Global settings</h1>
<h2><a class="anchor" id="shGlobalSettingBool"></a>
shGlobalSettingBool</h2>
<p>Retrieves the boolean value of a specific global setting, gets replaced with either 0 or 1. The value can be set using <a class="el" href="classsh_1_1_factory.html#a69102620d58385292ad0b2b920586f35">sh::Factory::setGlobalSetting</a>.</p>
<p><b>Usage:</b> @shGlobalSettingBool(settingName)</p>
<h2><a class="anchor" id="shGlobalSettingEqual"></a>
shGlobalSettingEqual</h2>
<p>Check if the value of a global setting equals a specific value, gets replaced with either 0 or 1. This is useful because the preprocessor cannot compare strings, only numbers.</p>
<p><b>Usage:</b> @shGlobalSettingEqual(settingName, value)</p>
<h2><a class="anchor" id="shGlobalSettingString"></a>
shGlobalSettingString</h2>
<p>Gets replaced with the current value of a given global setting. The value can be set using <a class="el" href="classsh_1_1_factory.html#a69102620d58385292ad0b2b920586f35">sh::Factory::setGlobalSetting</a>.</p>
<p><b>Usage:</b> @shGlobalSettingString(settingName)</p>
<h1><a class="anchor" id="sharedParams"></a>
Shared parameters</h1>
<h2><a class="anchor" id="shSharedParameter"></a>
shSharedParameter</h2>
<p>Allows you to bind a custom value to a uniform parameter.</p>
<p><b>Usage</b>: @shSharedParameter(sharedParameterName)</p>
<p><b>Example</b>: @shSharedParameter(pssmSplitPoints) - now the uniform parameter 'pssmSplitPoints' can be altered in all shaders that use it by executing <a class="el" href="classsh_1_1_factory.html#a65879df58981e68cecd131c534d7f640">sh::Factory::setSharedParameter</a>("pssmSplitPoints", value)</p>
<dl class="section note"><dt>Note</dt><dd>You may use the same shared parameter in as many shaders as you want. But don't forget to add the @shSharedParameter macro to every shader that uses this shared parameter.</dd></dl>
<h1><a class="anchor" id="autoconstants"></a>
Auto constants</h1>
<h2><a class="anchor" id="shAutoConstant"></a>
shAutoConstant</h2>
<p><b>Usage:</b> @shAutoConstant(uniformName, autoConstantName, [extraData])</p>
<p><b>Example</b>: @shAutoConstant(uModelViewMatrix, worldviewproj_matrix)</p>
<p><b>Example</b>: @shAutoConstant(uLightPosition4, light_position, 4)</p>
<p>Binds auto constant with name <em>autoConstantName</em> to the uniform <em>uniformName</em>. Optionally, you may specify extra data (for example the light index), as required by some auto constants.</p>
<p>The auto constant names are the same as Ogre's. Read the section "3.1.9 Using Vertex/Geometry/Fragment Programs in a Pass" of the Ogre manual for a list of all auto constant names.</p>
<h1><a class="anchor" id="misc"></a>
Misc</h1>
<h2><a class="anchor" id="shForeach"></a>
shForeach</h2>
<p><b>Usage:</b> @shForeach(n)</p>
<p>Repeats the content of this foreach block <em>n</em> times. The end of the block is marked via @shEndForeach, and the current iteration number can be retrieved via @shIterator.</p>
<dl class="section note"><dt>Note</dt><dd>Nested foreach blocks are currently <em>not</em> supported.</dd>
<dd>
For technical reasons, you can only use constant numbers, properties (@shPropertyString) or global settings (@shGlobalSettingString) as <em>n</em> parameter.</dd></dl>
<p><b>Example:</b></p>
<div class="fragment"><div class="line">@shForeach(3)</div><div class="line">this is iteration number @shIterator</div><div class="line">@shEndForeach</div><div class="line"></div><div class="line">Gets replaced with:</div><div class="line"></div><div class="line">this is iteration number 0</div><div class="line">this is iteration number 1</div><div class="line">this is iteration number 2</div></div><!-- fragment --><p>Optionally, you can pass a constant offset to @shIterator. Example:</p>
<div class="fragment"><div class="line">@shForeach(3)</div><div class="line">this is iteration number @shIterator(7)</div><div class="line">@shEndForeach</div><div class="line"></div><div class="line">Gets replaced with:</div><div class="line"></div><div class="line">this is iteration number 7</div><div class="line">this is iteration number 8</div><div class="line">this is iteration number 9</div></div><!-- fragment --><h2><a class="anchor" id="shCounter"></a>
shCounter</h2>
<p>Gets replaced after the preprocessing step with the number that equals the n-th occurence of counters of the same ID.</p>
<p><b>Usage:</b> @shCounter(ID)</p>
<p><b>Example</b>: </p><div class="fragment"><div class="line">@shCounter(0)</div><div class="line">@shCounter(0)</div><div class="line">@shCounter(1)</div><div class="line">@shCounter(0)</div></div><!-- fragment --><p>Gets replaced with:</p>
<div class="fragment"><div class="line">0</div><div class="line">1</div><div class="line">0</div><div class="line">2</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
